---
title: "Reproducible Research"
author: "Des"
date: "28/04/2021"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

## Loading and preprocessing the data

Libraries used 

```{r}

library(plyr)

library(ggplot2)

library(magrittr)

library(dplyr)

```


Code for reading data sets

```{r}

activity <- data.table:: fread("activity.csv", sep = ",")

```

Calculating the sum of steps taken

```{r}

totalSteps <- aggregate(activity$steps~activity$date, FUN = sum,)
colnames(totalSteps) <- c("Date", "Steps")

```

Histogram for total number of steps taken

```{r}
hist(totalSteps$Steps, breaks=5, xlab="Steps", main = "Total Steps per Day")

```

## What is mean total number of steps taken per day?

Mean and median of total steps(Fist answer is for mean, second median) 

```{r}

as.integer(mean(totalSteps$Steps))

as.integer(median(totalSteps$Steps))

```
Since our data has Na's we want to pull out all of the values that we are not going to use

```{r}

PullOutNAS <- activity[!is.na(activity$steps),]

```

## What is the average daily activity pattern?

Time series plot of the average number of steps taken

```{r}

intervalSteps <- ddply(PullOutNAS, .(interval), summarize, Avg = mean(steps))

ggplot(intervalSteps, aes(x=interval, y=Avg), xlab = "Interval", ylab="Average Number of Steps") + geom_line()+xlab("Interval")+ylab("Average Number of Steps") + ggtitle("Average Number of Steps per Interval")

```

The five minute interval showing maximum steps taken on average

```{r}

maxSteps <- max(intervalSteps$Avg) 

intervalSteps[intervalSteps$Avg==maxSteps,1]

```
Showing missing value

```{r}
nrow(activity[is.na(activity$steps),])
````

## Imputing missing values

Strategy for missing value 

```{r}
withoutNAs <- numeric(nrow(activity))
for (i in 1:nrow(activity))
{
        if (is.na(activity[i,"steps"])==TRUE)
            {
                    withoutNAs[i]<-filter(intervalSteps,interval==activity[i,"interval"]) %>% select(Avg)
            } 
        else
            {
                    withoutNAs[i]<-activity[i,"steps"]
            }
                    
}


withoutnas <- activity[is.na(activity$steps),]

```



Merge data for new data set

```{r}
activity[is.na(steps), "steps"] <- activity[, c(lapply(.SD, mean, na.rm = TRUE)), .SDcols = c("steps")]


```


New dataset with missing values filled


```{r}

data.table::fwrite(x = activity, file = "activity.csv", quote = FALSE)
```

New total steps

```{r}

newtotalsteps<- activity[, c(lapply(.SD, sum)), .SDcols = c("steps"), by = .(date)] 

```

Mean and median of new 
```{r}

newtotalsteps[, .(Mean_Steps = mean(steps), Median_Steps = median(steps))]



```
Histogram of new dataset

```{r}

ggplot(newtotalsteps, aes(x = steps)) + geom_histogram(binwidth = 1000) + labs(title = "Daily Steps", x = "Steps", y = "Frequency")

```


